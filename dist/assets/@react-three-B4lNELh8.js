import{r as u,j as G}from"./react-j2NvMOCs.js";import{m as Me,T as We,R as nn,f as rn,n as on,o as sn,p as bt,q as wt,O as qe,r as Ue,S as Ce,s as Se,t as an,A as ln,u as Xe,V as U,a as cn,v as un,w as fn,x as dn,y as pn,z as mn,E as vn,G as Et,J as Ye,W as hn,L as st,H as _t,K as gn,F as yn,Q as bn,X as wn,Y as En,Z as _n}from"./three-CGVMCGXA.js";import{u as Cn}from"./react-use-measure-C2DBzy9W.js";import{F as Pn,u as xn}from"./its-fine-BwtxgHX3.js";import{R as Mn,c as le}from"./react-reconciler-C0546Jl3.js";import{_ as J}from"./@babel-CF3RwP-h.js";import{c as Sn}from"./react-dom-C14NNex4.js";import{G as Ke,D as Rn,M as Re,O as jn,R as On,E as kn,a as Tn}from"./three-stdlib-uS82H3Ms.js";import{H as Ln,G as An}from"./@monogrid-DLpdTI1n.js";import{t as In}from"./tunnel-rat-KaS1F4Mx.js";import{c as Ct}from"./zustand-CufyI951.js";import{s as Fn,p as Dn,c as zn}from"./suspend-react-BKIKQNXN.js";function Wr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Pt={exports:{}},xt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(w,M){var x=w.length;w.push(M);e:for(;0<x;){var j=x-1>>>1,L=w[j];if(0<a(L,M))w[j]=M,w[x]=L,x=j;else break e}}function o(w){return w.length===0?null:w[0]}function i(w){if(w.length===0)return null;var M=w[0],x=w.pop();if(x!==M){w[0]=x;e:for(var j=0,L=w.length,T=L>>>1;j<T;){var W=2*(j+1)-1,V=w[W],Y=W+1,re=w[Y];if(0>a(V,x))Y<L&&0>a(re,V)?(w[j]=re,w[Y]=x,j=Y):(w[j]=V,w[W]=x,j=W);else if(Y<L&&0>a(re,x))w[j]=re,w[Y]=x,j=Y;else break e}}return M}function a(w,M){var x=w.sortIndex-M.sortIndex;return x!==0?x:w.id-M.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var f=Date,m=f.now();e.unstable_now=function(){return f.now()-m}}var l=[],v=[],r=1,n=null,s=3,g=!1,h=!1,b=!1,d=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(w){for(var M=o(v);M!==null;){if(M.callback===null)i(v);else if(M.startTime<=w)i(v),M.sortIndex=M.expirationTime,t(l,M);else break;M=o(v)}}function S(w){if(b=!1,C(w),!h)if(o(l)!==null)h=!0,N(P);else{var M=o(v);M!==null&&H(S,M.startTime-w)}}function P(w,M){h=!1,b&&(b=!1,p(O),O=-1),g=!0;var x=s;try{for(C(M),n=o(l);n!==null&&(!(n.expirationTime>M)||w&&!_());){var j=n.callback;if(typeof j=="function"){n.callback=null,s=n.priorityLevel;var L=j(n.expirationTime<=M);M=e.unstable_now(),typeof L=="function"?n.callback=L:n===o(l)&&i(l),C(M)}else i(l);n=o(l)}if(n!==null)var T=!0;else{var W=o(v);W!==null&&H(S,W.startTime-M),T=!1}return T}finally{n=null,s=x,g=!1}}var E=!1,k=null,O=-1,R=5,I=-1;function _(){return!(e.unstable_now()-I<R)}function A(){if(k!==null){var w=e.unstable_now();I=w;var M=!0;try{M=k(!0,w)}finally{M?$():(E=!1,k=null)}}else E=!1}var $;if(typeof y=="function")$=function(){y(A)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,B=X.port2;X.port1.onmessage=A,$=function(){B.postMessage(null)}}else $=function(){d(A,0)};function N(w){k=w,E||(E=!0,$())}function H(w,M){O=d(function(){w(e.unstable_now())},M)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(w){w.callback=null},e.unstable_continueExecution=function(){h||g||(h=!0,N(P))},e.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<w?Math.floor(1e3/w):5},e.unstable_getCurrentPriorityLevel=function(){return s},e.unstable_getFirstCallbackNode=function(){return o(l)},e.unstable_next=function(w){switch(s){case 1:case 2:case 3:var M=3;break;default:M=s}var x=s;s=M;try{return w()}finally{s=x}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(w,M){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var x=s;s=w;try{return M()}finally{s=x}},e.unstable_scheduleCallback=function(w,M,x){var j=e.unstable_now();switch(typeof x=="object"&&x!==null?(x=x.delay,x=typeof x=="number"&&0<x?j+x:j):x=j,w){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=x+L,w={id:r++,callback:M,priorityLevel:w,startTime:x,expirationTime:L,sortIndex:-1},x>j?(w.sortIndex=x,t(v,w),o(l)===null&&w===o(v)&&(b?(p(O),O=-1):b=!0,H(S,x-j))):(w.sortIndex=L,t(l,w),h||g||(h=!0,N(P))),w},e.unstable_shouldYield=_,e.unstable_wrapCallback=function(w){var M=s;return function(){var x=s;s=M;try{return w.apply(this,arguments)}finally{s=x}}}})(xt);Pt.exports=xt;var at=Pt.exports;const Ze={},Mt=e=>void Object.assign(Ze,e);function Bn(e,t){function o(r,{args:n=[],attach:s,...g},h){let b=`${r[0].toUpperCase()}${r.slice(1)}`,d;if(r==="primitive"){if(g.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const p=g.object;d=se(p,{type:r,root:h,attach:s,primitive:!0})}else{const p=Ze[b];if(!p)throw new Error(`R3F: ${b} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(n))throw new Error("R3F: The args prop must be an array!");d=se(new p(...n),{type:r,root:h,attach:s,memoizedProps:{args:n}})}return d.__r3f.attach===void 0&&(d instanceof on?d.__r3f.attach="geometry":d instanceof sn&&(d.__r3f.attach="material")),b!=="inject"&&ke(d,g),d}function i(r,n){let s=!1;if(n){var g,h;(g=n.__r3f)!=null&&g.attach?Oe(r,n,n.__r3f.attach):n.isObject3D&&r.isObject3D&&(r.add(n),s=!0),s||(h=r.__r3f)==null||h.objects.push(n),n.__r3f||se(n,{}),n.__r3f.parent=r,Ne(n),ae(n)}}function a(r,n,s){let g=!1;if(n){var h,b;if((h=n.__r3f)!=null&&h.attach)Oe(r,n,n.__r3f.attach);else if(n.isObject3D&&r.isObject3D){n.parent=r,n.dispatchEvent({type:"added"}),r.dispatchEvent({type:"childadded",child:n});const d=r.children.filter(y=>y!==n),p=d.indexOf(s);r.children=[...d.slice(0,p),n,...d.slice(p)],g=!0}g||(b=r.__r3f)==null||b.objects.push(n),n.__r3f||se(n,{}),n.__r3f.parent=r,Ne(n),ae(n)}}function c(r,n,s=!1){r&&[...r].forEach(g=>f(n,g,s))}function f(r,n,s){if(n){var g,h,b;if(n.__r3f&&(n.__r3f.parent=null),(g=r.__r3f)!=null&&g.objects&&(r.__r3f.objects=r.__r3f.objects.filter(S=>S!==n)),(h=n.__r3f)!=null&&h.attach)dt(r,n,n.__r3f.attach);else if(n.isObject3D&&r.isObject3D){var d;r.remove(n),(d=n.__r3f)!=null&&d.root&&Un(_e(n),n)}const y=(b=n.__r3f)==null?void 0:b.primitive,C=!y&&(s===void 0?n.dispose!==null:s);if(!y){var p;c((p=n.__r3f)==null?void 0:p.objects,n,C),c(n.children,n,C)}if(delete n.__r3f,C&&n.dispose&&n.type!=="Scene"){const S=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?at.unstable_scheduleCallback(at.unstable_IdlePriority,S):S()}ae(r)}}function m(r,n,s,g){var h;const b=(h=r.__r3f)==null?void 0:h.parent;if(!b)return;const d=o(n,s,r.__r3f.root);if(r.children){for(const p of r.children)p.__r3f&&i(d,p);r.children=r.children.filter(p=>!p.__r3f)}r.__r3f.objects.forEach(p=>i(d,p)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||f(b,r),d.parent&&(d.__r3f.autoRemovedBeforeAppend=!0),i(b,d),d.raycast&&d.__r3f.eventCount&&_e(d).getState().internal.interaction.push(d),[g,g.alternate].forEach(p=>{p!==null&&(p.stateNode=d,p.ref&&(typeof p.ref=="function"?p.ref(d):p.ref.current=d))})}const l=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Mn({createInstance:o,removeChild:f,appendChild:i,appendInitialChild:i,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,n)=>{if(!n)return;const s=r.getState().scene;s.__r3f&&(s.__r3f.root=r,i(s,n))},removeChildFromContainer:(r,n)=>{n&&f(r.getState().scene,n)},insertInContainerBefore:(r,n,s)=>{if(!n||!s)return;const g=r.getState().scene;g.__r3f&&a(g,n,s)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var n;return!!((n=r==null?void 0:r.__r3f)!=null?n:{}).handlers},prepareUpdate(r,n,s,g){var h;if(((h=r==null?void 0:r.__r3f)!=null?h:{}).primitive&&g.object&&g.object!==r)return[!0];{const{args:d=[],children:p,...y}=g,{args:C=[],children:S,...P}=s;if(!Array.isArray(d))throw new Error("R3F: the args prop must be an array!");if(d.some((k,O)=>k!==C[O]))return[!0];const E=Lt(r,y,P,!0);return E.changes.length?[!1,E]:null}},commitUpdate(r,[n,s],g,h,b,d){n?m(r,g,b,d):ke(r,s)},commitMount(r,n,s,g){var h;const b=(h=r.__r3f)!=null?h:{};r.raycast&&b.handlers&&b.eventCount&&_e(r).getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>se(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var n;const{attach:s,parent:g}=(n=r.__r3f)!=null?n:{};s&&g&&dt(g,r,s),r.isObject3D&&(r.visible=!1),ae(r)},unhideInstance(r,n){var s;const{attach:g,parent:h}=(s=r.__r3f)!=null?s:{};g&&h&&Oe(h,r,g),(r.isObject3D&&n.visible==null||n.visible)&&(r.visible=!0),ae(r)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>t?t():le.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&F.fun(performance.now)?performance.now:F.fun(Date.now)?Date.now:()=>0,scheduleTimeout:F.fun(setTimeout)?setTimeout:void 0,cancelTimeout:F.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ke}}var lt,ct;const je=e=>"colorSpace"in e||"outputColorSpace"in e,St=()=>{var e;return(e=Ze.ColorManagement)!=null?e:null},Rt=e=>e&&e.isOrthographicCamera,Hn=e=>e&&e.hasOwnProperty("current"),me=typeof window<"u"&&((lt=window.document)!=null&&lt.createElement||((ct=window.navigator)==null?void 0:ct.product)==="ReactNative")?u.useLayoutEffect:u.useEffect;function jt(e){const t=u.useRef(e);return me(()=>void(t.current=e),[e]),t}function $n({set:e}){return me(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Ot extends u.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Ot.getDerivedStateFromError=()=>({error:!0});const kt="__default",ut=new Map,Wn=e=>e&&!!e.memoized&&!!e.changes;function Tt(e){var t;const o=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const fe=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function _e(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const F={obj:e=>e===Object(e)&&!F.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:i="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(F.str(e)||F.num(e)||F.boo(e))return e===t;const c=F.obj(e);if(c&&i==="reference")return e===t;const f=F.arr(e);if(f&&o==="reference")return e===t;if((f||c)&&e===t)return!0;let m;for(m in e)if(!(m in t))return!1;if(c&&o==="shallow"&&i==="shallow"){for(m in a?t:e)if(!F.equ(e[m],t[m],{strict:a,objects:"reference"}))return!1}else for(m in a?t:e)if(e[m]!==t[m])return!1;if(F.und(m)){if(f&&e.length===0&&t.length===0||c&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Gn(e){const t={nodes:{},materials:{}};return e&&e.traverse(o=>{o.name&&(t.nodes[o.name]=o),o.material&&!t.materials[o.material.name]&&(t.materials[o.material.name]=o.material)}),t}function Nn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function se(e,t){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Ge(e,t){let o=e;if(t.includes("-")){const i=t.split("-"),a=i.pop();return o=i.reduce((c,f)=>c[f],e),{target:o,key:a}}else return{target:o,key:t}}const ft=/-\d+$/;function Oe(e,t,o){if(F.str(o)){if(ft.test(o)){const c=o.replace(ft,""),{target:f,key:m}=Ge(e,c);Array.isArray(f[m])||(f[m]=[])}const{target:i,key:a}=Ge(e,o);t.__r3f.previousAttach=i[a],i[a]=t}else t.__r3f.previousAttach=o(e,t)}function dt(e,t,o){var i,a;if(F.str(o)){const{target:c,key:f}=Ge(e,o),m=t.__r3f.previousAttach;m===void 0?delete c[f]:c[f]=m}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function Lt(e,{children:t,key:o,ref:i,...a},{children:c,key:f,ref:m,...l}={},v=!1){const r=e.__r3f,n=Object.entries(a),s=[];if(v){const h=Object.keys(l);for(let b=0;b<h.length;b++)a.hasOwnProperty(h[b])||n.unshift([h[b],kt+"remove"])}n.forEach(([h,b])=>{var d;if((d=e.__r3f)!=null&&d.primitive&&h==="object"||F.equ(b,l[h]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(h))return s.push([h,b,!0,[]]);let p=[];h.includes("-")&&(p=h.split("-")),s.push([h,b,!1,p]);for(const y in a){const C=a[y];y.startsWith(`${h}-`)&&s.push([y,C,!1,y.split("-")])}});const g={...a};return r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.args&&(g.args=r.memoizedProps.args),r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.attach&&(g.attach=r.memoizedProps.attach),{memoized:g,changes:s}}const Vn=typeof process<"u"&&!1;function ke(e,t){var o;const i=e.__r3f,a=i==null?void 0:i.root,c=a==null||a.getState==null?void 0:a.getState(),{memoized:f,changes:m}=Wn(t)?t:Lt(e,t),l=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=f);for(let r=0;r<m.length;r++){let[n,s,g,h]=m[r];if(je(e)){const y="srgb",C="srgb-linear";n==="encoding"?(n="colorSpace",s=s===3001?y:C):n==="outputEncoding"&&(n="outputColorSpace",s=s===3001?y:C)}let b=e,d=b[n];if(h.length&&(d=h.reduce((p,y)=>p[y],e),!(d&&d.set))){const[p,...y]=h.reverse();b=y.reverse().reduce((C,S)=>C[S],e),n=p}if(s===kt+"remove")if(b.constructor){let p=ut.get(b.constructor);p||(p=new b.constructor,ut.set(b.constructor,p)),s=p[n]}else s=0;if(g&&i)s?i.handlers[n]=s:delete i.handlers[n],i.eventCount=Object.keys(i.handlers).length;else if(d&&d.set&&(d.copy||d instanceof Me)){if(Array.isArray(s))d.fromArray?d.fromArray(s):d.set(...s);else if(d.copy&&s&&s.constructor&&(Vn?d.constructor.name===s.constructor.name:d.constructor===s.constructor))d.copy(s);else if(s!==void 0){const p=d instanceof bt;!p&&d.setScalar?d.setScalar(s):d instanceof Me&&s instanceof Me?d.mask=s.mask:d.set(s),!St()&&c&&!c.linear&&p&&d.convertSRGBToLinear()}}else if(b[n]=s,b[n]instanceof We&&b[n].format===nn&&b[n].type===rn&&c){const p=b[n];je(p)&&je(c.gl)?p.colorSpace=c.gl.outputColorSpace:p.encoding=c.gl.outputEncoding}ae(e)}if(i&&i.parent&&e.raycast&&l!==i.eventCount){const r=_e(e).getState().internal,n=r.interaction.indexOf(e);n>-1&&r.interaction.splice(n,1),i.eventCount&&r.interaction.push(e)}return!(m.length===1&&m[0][0]==="onUpdate")&&m.length&&(o=e.__r3f)!=null&&o.parent&&Ne(e),e}function ae(e){var t,o;const i=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function Ne(e){e.onUpdate==null||e.onUpdate(e)}function At(e,t){e.manual||(Rt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ye(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function qn(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return le.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return le.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return le.ContinuousEventPriority;default:return le.DefaultEventPriority}}function It(e,t,o,i){const a=o.get(t);a&&(o.delete(t),o.size===0&&(e.delete(i),a.target.releasePointerCapture(i)))}function Un(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==t),o.initialHits=o.initialHits.filter(i=>i!==t),o.hovered.forEach((i,a)=>{(i.eventObject===t||i.object===t)&&o.hovered.delete(a)}),o.capturedMap.forEach((i,a)=>{It(o.capturedMap,t,i,a)})}function Xn(e){function t(l){const{internal:v}=e.getState(),r=l.offsetX-v.initialClick[0],n=l.offsetY-v.initialClick[1];return Math.round(Math.sqrt(r*r+n*n))}function o(l){return l.filter(v=>["Move","Over","Enter","Out","Leave"].some(r=>{var n;return(n=v.__r3f)==null?void 0:n.handlers["onPointer"+r]}))}function i(l,v){const r=e.getState(),n=new Set,s=[],g=v?v(r.internal.interaction):r.internal.interaction;for(let p=0;p<g.length;p++){const y=fe(g[p]);y&&(y.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(l,r);function h(p){const y=fe(p);if(!y||!y.events.enabled||y.raycaster.camera===null)return[];if(y.raycaster.camera===void 0){var C;y.events.compute==null||y.events.compute(l,y,(C=y.previousRoot)==null?void 0:C.getState()),y.raycaster.camera===void 0&&(y.raycaster.camera=null)}return y.raycaster.camera?y.raycaster.intersectObject(p,!0):[]}let b=g.flatMap(h).sort((p,y)=>{const C=fe(p.object),S=fe(y.object);return!C||!S?p.distance-y.distance:S.events.priority-C.events.priority||p.distance-y.distance}).filter(p=>{const y=ye(p);return n.has(y)?!1:(n.add(y),!0)});r.events.filter&&(b=r.events.filter(b,r));for(const p of b){let y=p.object;for(;y;){var d;(d=y.__r3f)!=null&&d.eventCount&&s.push({...p,eventObject:y}),y=y.parent}}if("pointerId"in l&&r.internal.capturedMap.has(l.pointerId))for(let p of r.internal.capturedMap.get(l.pointerId).values())n.has(ye(p.intersection))||s.push(p.intersection);return s}function a(l,v,r,n){const s=e.getState();if(l.length){const g={stopped:!1};for(const h of l){const b=fe(h.object)||s,{raycaster:d,pointer:p,camera:y,internal:C}=b,S=new U(p.x,p.y,0).unproject(y),P=I=>{var _,A;return(_=(A=C.capturedMap.get(I))==null?void 0:A.has(h.eventObject))!=null?_:!1},E=I=>{const _={intersection:h,target:v.target};C.capturedMap.has(I)?C.capturedMap.get(I).set(h.eventObject,_):C.capturedMap.set(I,new Map([[h.eventObject,_]])),v.target.setPointerCapture(I)},k=I=>{const _=C.capturedMap.get(I);_&&It(C.capturedMap,h.eventObject,_,I)};let O={};for(let I in v){let _=v[I];typeof _!="function"&&(O[I]=_)}let R={...h,...O,pointer:p,intersections:l,stopped:g.stopped,delta:r,unprojectedPoint:S,ray:d.ray,camera:y,stopPropagation(){const I="pointerId"in v&&C.capturedMap.get(v.pointerId);if((!I||I.has(h.eventObject))&&(R.stopped=g.stopped=!0,C.hovered.size&&Array.from(C.hovered.values()).find(_=>_.eventObject===h.eventObject))){const _=l.slice(0,l.indexOf(h));c([..._,h])}},target:{hasPointerCapture:P,setPointerCapture:E,releasePointerCapture:k},currentTarget:{hasPointerCapture:P,setPointerCapture:E,releasePointerCapture:k},nativeEvent:v};if(n(R),g.stopped===!0)break}}return l}function c(l){const{internal:v}=e.getState();for(const r of v.hovered.values())if(!l.length||!l.find(n=>n.object===r.object&&n.index===r.index&&n.instanceId===r.instanceId)){const s=r.eventObject.__r3f,g=s==null?void 0:s.handlers;if(v.hovered.delete(ye(r)),s!=null&&s.eventCount){const h={...r,intersections:l};g.onPointerOut==null||g.onPointerOut(h),g.onPointerLeave==null||g.onPointerLeave(h)}}}function f(l,v){for(let r=0;r<v.length;r++){const n=v[r].__r3f;n==null||n.handlers.onPointerMissed==null||n.handlers.onPointerMissed(l)}}function m(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>c([]);case"onLostPointerCapture":return v=>{const{internal:r}=e.getState();"pointerId"in v&&r.capturedMap.has(v.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(v.pointerId)&&(r.capturedMap.delete(v.pointerId),c([]))})}}return function(r){const{onPointerMissed:n,internal:s}=e.getState();s.lastEvent.current=r;const g=l==="onPointerMove",h=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",d=i(r,g?o:void 0),p=h?t(r):0;l==="onPointerDown"&&(s.initialClick=[r.offsetX,r.offsetY],s.initialHits=d.map(C=>C.eventObject)),h&&!d.length&&p<=2&&(f(r,s.interaction),n&&n(r)),g&&c(d);function y(C){const S=C.eventObject,P=S.__r3f,E=P==null?void 0:P.handlers;if(P!=null&&P.eventCount)if(g){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const k=ye(C),O=s.hovered.get(k);O?O.stopped&&C.stopPropagation():(s.hovered.set(k,C),E.onPointerOver==null||E.onPointerOver(C),E.onPointerEnter==null||E.onPointerEnter(C))}E.onPointerMove==null||E.onPointerMove(C)}else{const k=E[l];k?(!h||s.initialHits.includes(S))&&(f(r,s.interaction.filter(O=>!s.initialHits.includes(O))),k(C)):h&&s.initialHits.includes(S)&&f(r,s.interaction.filter(O=>!s.initialHits.includes(O)))}}a(d,r,p,y)}}return{handlePointer:m}}const Yn=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],Ft=e=>!!(e!=null&&e.render),Pe=u.createContext(null),Kn=(e,t)=>{const o=Ct((m,l)=>{const v=new U,r=new U,n=new U;function s(p=l().camera,y=r,C=l().size){const{width:S,height:P,top:E,left:k}=C,O=S/P;y instanceof U?n.copy(y):n.set(...y);const R=p.getWorldPosition(v).distanceTo(n);if(Rt(p))return{width:S/p.zoom,height:P/p.zoom,top:E,left:k,factor:1,distance:R,aspect:O};{const I=p.fov*Math.PI/180,_=2*Math.tan(I/2)*R,A=_*(S/P);return{width:A,height:_,top:E,left:k,factor:S/A,distance:R,aspect:O}}}let g;const h=p=>m(y=>({performance:{...y.performance,current:p}})),b=new Xe;return{set:m,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(p=1)=>e(l(),p),advance:(p,y)=>t(p,y,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new mn,pointer:b,mouse:b,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const p=l();g&&clearTimeout(g),p.performance.current!==p.performance.min&&h(p.performance.min),g=setTimeout(()=>h(l().performance.max),p.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:s},setEvents:p=>m(y=>({...y,events:{...y.events,...p}})),setSize:(p,y,C,S,P)=>{const E=l().camera,k={width:p,height:y,top:S||0,left:P||0,updateStyle:C};m(O=>({size:k,viewport:{...O.viewport,...s(E,r,k)}}))},setDpr:p=>m(y=>{const C=Tt(p);return{viewport:{...y.viewport,dpr:C,initialDpr:y.viewport.initialDpr||C}}}),setFrameloop:(p="always")=>{const y=l().clock;y.stop(),y.elapsedTime=0,p!=="never"&&(y.start(),y.elapsedTime=0),m(()=>({frameloop:p}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:u.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(p,y,C)=>{const S=l().internal;return S.priority=S.priority+(y>0?1:0),S.subscribers.push({ref:p,priority:y,store:C}),S.subscribers=S.subscribers.sort((P,E)=>P.priority-E.priority),()=>{const P=l().internal;P!=null&&P.subscribers&&(P.priority=P.priority-(y>0?1:0),P.subscribers=P.subscribers.filter(E=>E.ref!==p))}}}}}),i=o.getState();let a=i.size,c=i.viewport.dpr,f=i.camera;return o.subscribe(()=>{const{camera:m,size:l,viewport:v,gl:r,set:n}=o.getState();if(l.width!==a.width||l.height!==a.height||v.dpr!==c){var s;a=l,c=v.dpr,At(m,l),r.setPixelRatio(v.dpr);const g=(s=l.updateStyle)!=null?s:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(l.width,l.height,g)}m!==f&&(f=m,n(g=>({viewport:{...g.viewport,...g.viewport.getCurrentViewport(m)}})))}),o.subscribe(m=>e(m)),o};let be,Zn=new Set,Jn=new Set,Qn=new Set;function Te(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function de(e,t){switch(e){case"before":return Te(Zn,t);case"after":return Te(Jn,t);case"tail":return Te(Qn,t)}}let Le,Ae;function Ie(e,t,o){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Le=t.internal.subscribers,be=0;be<Le.length;be++)Ae=Le[be],Ae.ref.current(Ae.store.getState(),i,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function er(e){let t=!1,o=!1,i,a,c;function f(v){a=requestAnimationFrame(f),t=!0,i=0,de("before",v),o=!0;for(const n of e.values()){var r;c=n.store.getState(),c.internal.active&&(c.frameloop==="always"||c.internal.frames>0)&&!((r=c.gl.xr)!=null&&r.isPresenting)&&(i+=Ie(v,c))}if(o=!1,de("after",v),i===0)return de("tail",v),t=!1,cancelAnimationFrame(a)}function m(v,r=1){var n;if(!v)return e.forEach(s=>m(s.store.getState(),r));(n=v.gl.xr)!=null&&n.isPresenting||!v.internal.active||v.frameloop==="never"||(r>1?v.internal.frames=Math.min(60,v.internal.frames+r):o?v.internal.frames=2:v.internal.frames=1,t||(t=!0,requestAnimationFrame(f)))}function l(v,r=!0,n,s){if(r&&de("before",v),n)Ie(v,n,s);else for(const g of e.values())Ie(v,g.store.getState());r&&de("after",v)}return{loop:f,invalidate:m,advance:l}}function Je(){const e=u.useContext(Pe);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function z(e=o=>o,t){return Je()(e,t)}function ve(e,t=0){const o=Je(),i=o.getState().internal.subscribe,a=jt(e);return me(()=>i(a,t,o),[t,i,o]),null}const pt=new WeakMap;function Dt(e,t){return function(o,...i){let a=pt.get(o);return a||(a=new o,pt.set(o,a)),e&&e(a),Promise.all(i.map(c=>new Promise((f,m)=>a.load(c,l=>{l.scene&&Object.assign(l,Gn(l.scene)),f(l)},t,l=>m(new Error(`Could not load ${c}: ${l==null?void 0:l.message}`))))))}}function Q(e,t,o,i){const a=Array.isArray(t)?t:[t],c=Fn(Dt(o,i),[e,...a],{equal:F.equ});return Array.isArray(t)?c:c[0]}Q.preload=function(e,t,o){const i=Array.isArray(t)?t:[t];return Dn(Dt(o),[e,...i])};Q.clear=function(e,t){const o=Array.isArray(t)?t:[t];return zn([e,...o])};const ce=new Map,{invalidate:mt,advance:vt}=er(ce),{reconciler:pe,applyProps:Z}=Bn(ce,qn),ie={objects:"shallow",strict:!1},tr=(e,t)=>{const o=typeof e=="function"?e(t):e;return Ft(o)?o:new cn({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function nr(e,t){const o=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:a,top:c,left:f,updateStyle:m=o}=t;return{width:i,height:a,top:c,left:f,updateStyle:m}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:a,top:c,left:f}=e.parentElement.getBoundingClientRect();return{width:i,height:a,top:c,left:f,updateStyle:o}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:o};return{width:0,height:0,top:0,left:0}}function rr(e){const t=ce.get(e),o=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,c=i||Kn(mt,vt),f=o||pe.createContainer(c,le.ConcurrentRoot,null,!1,null,"",a,null);t||ce.set(e,{fiber:f,store:c});let m,l=!1,v;return{configure(r={}){let{gl:n,size:s,scene:g,events:h,onCreated:b,shadows:d=!1,linear:p=!1,flat:y=!1,legacy:C=!1,orthographic:S=!1,frameloop:P="always",dpr:E=[1,2],performance:k,raycaster:O,camera:R,onPointerMissed:I}=r,_=c.getState(),A=_.gl;_.gl||_.set({gl:A=tr(n,e)});let $=_.raycaster;$||_.set({raycaster:$=new wt});const{params:X,...B}=O||{};if(F.equ(B,$,ie)||Z($,{...B}),F.equ(X,$.params,ie)||Z($,{params:{...$.params,...X}}),!_.camera||_.camera===v&&!F.equ(v,R,ie)){v=R;const x=R instanceof un,j=x?R:S?new qe(0,0,0,0,.1,1e3):new Ue(75,0,.1,1e3);x||(j.position.z=5,R&&(Z(j,R),("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(j.manual=!0,j.updateProjectionMatrix())),!_.camera&&!(R!=null&&R.rotation)&&j.lookAt(0,0,0)),_.set({camera:j}),$.camera=j}if(!_.scene){let x;g instanceof Ce?x=g:(x=new Ce,g&&Z(x,g)),_.set({scene:se(x)})}if(!_.xr){var N;const x=(T,W)=>{const V=c.getState();V.frameloop!=="never"&&vt(T,!0,V,W)},j=()=>{const T=c.getState();T.gl.xr.enabled=T.gl.xr.isPresenting,T.gl.xr.setAnimationLoop(T.gl.xr.isPresenting?x:null),T.gl.xr.isPresenting||mt(T)},L={connect(){const T=c.getState().gl;T.xr.addEventListener("sessionstart",j),T.xr.addEventListener("sessionend",j)},disconnect(){const T=c.getState().gl;T.xr.removeEventListener("sessionstart",j),T.xr.removeEventListener("sessionend",j)}};typeof((N=A.xr)==null?void 0:N.addEventListener)=="function"&&L.connect(),_.set({xr:L})}if(A.shadowMap){const x=A.shadowMap.enabled,j=A.shadowMap.type;if(A.shadowMap.enabled=!!d,F.boo(d))A.shadowMap.type=Se;else if(F.str(d)){var H;const L={basic:fn,percentage:dn,soft:Se,variance:pn};A.shadowMap.type=(H=L[d])!=null?H:Se}else F.obj(d)&&Object.assign(A.shadowMap,d);(x!==A.shadowMap.enabled||j!==A.shadowMap.type)&&(A.shadowMap.needsUpdate=!0)}const w=St();w&&("enabled"in w?w.enabled=!C:"legacyMode"in w&&(w.legacyMode=C)),l||Z(A,{outputEncoding:p?3e3:3001,toneMapping:y?an:ln}),_.legacy!==C&&_.set(()=>({legacy:C})),_.linear!==p&&_.set(()=>({linear:p})),_.flat!==y&&_.set(()=>({flat:y})),n&&!F.fun(n)&&!Ft(n)&&!F.equ(n,A,ie)&&Z(A,n),h&&!_.events.handlers&&_.set({events:h(c)});const M=nr(e,s);return F.equ(M,_.size,ie)||_.setSize(M.width,M.height,M.updateStyle,M.top,M.left),E&&_.viewport.dpr!==Tt(E)&&_.setDpr(E),_.frameloop!==P&&_.setFrameloop(P),_.onPointerMissed||_.set({onPointerMissed:I}),k&&!F.equ(k,_.performance,ie)&&_.set(x=>({performance:{...x.performance,...k}})),m=b,l=!0,this},render(r){return l||this.configure(),pe.updateContainer(G.jsx(or,{store:c,children:r,onCreated:m,rootElement:e}),f,null,()=>{}),c},unmount(){zt(e)}}}function or({store:e,children:t,onCreated:o,rootElement:i}){return me(()=>{const a=e.getState();a.set(c=>({internal:{...c.internal,active:!0}})),o&&o(a),e.getState().events.connected||a.events.connect==null||a.events.connect(i)},[]),G.jsx(Pe.Provider,{value:e,children:t})}function zt(e,t){const o=ce.get(e),i=o==null?void 0:o.fiber;if(i){const a=o==null?void 0:o.store.getState();a&&(a.internal.active=!1),pe.updateContainer(null,i,null,()=>{a&&setTimeout(()=>{try{var c,f,m,l;a.events.disconnect==null||a.events.disconnect(),(c=a.gl)==null||(f=c.renderLists)==null||f.dispose==null||f.dispose(),(m=a.gl)==null||m.forceContextLoss==null||m.forceContextLoss(),(l=a.gl)!=null&&l.xr&&a.xr.disconnect(),Nn(a),ce.delete(e)}catch{}},500)})}}function Bt(e,t,o){return G.jsx(ir,{children:e,container:t,state:o},t.uuid)}function ir({state:e={},children:t,container:o}){const{events:i,size:a,...c}=e,f=Je(),[m]=u.useState(()=>new wt),[l]=u.useState(()=>new Xe),v=u.useCallback((n,s)=>{const g={...n};Object.keys(n).forEach(b=>{(Yn.includes(b)||n[b]!==s[b]&&s[b])&&delete g[b]});let h;if(s&&a){const b=s.camera;h=n.viewport.getCurrentViewport(b,new U,a),b!==n.camera&&At(b,a)}return{...g,scene:o,raycaster:m,pointer:l,mouse:l,previousRoot:f,events:{...n.events,...s==null?void 0:s.events,...i},size:{...n.size,...a},viewport:{...n.viewport,...h},...c}},[e]),[r]=u.useState(()=>{const n=f.getState();return Ct((g,h)=>({...n,scene:o,raycaster:m,pointer:l,mouse:l,previousRoot:f,events:{...n.events,...i},size:{...n.size,...a},...c,set:g,get:h,setEvents:b=>g(d=>({...d,events:{...d.events,...b}}))}))});return u.useEffect(()=>{const n=f.subscribe(s=>r.setState(g=>v(s,g)));return()=>{n()}},[v]),u.useEffect(()=>{r.setState(n=>v(f.getState(),n))},[v]),u.useEffect(()=>()=>{r.destroy()},[]),G.jsx(G.Fragment,{children:pe.createPortal(G.jsx(Pe.Provider,{value:r,children:t}),r,null)})}pe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:u.version});const Fe={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function sr(e){const{handlePointer:t}=Xn(e);return{priority:1,enabled:!0,compute(o,i,a){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Fe).reduce((o,i)=>({...o,[i]:t(i)}),{}),update:()=>{var o;const{events:i,internal:a}=e.getState();(o=a.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(a.lastEvent.current)},connect:o=>{var i;const{set:a,events:c}=e.getState();c.disconnect==null||c.disconnect(),a(f=>({events:{...f.events,connected:o}})),Object.entries((i=c.handlers)!=null?i:[]).forEach(([f,m])=>{const[l,v]=Fe[f];o.addEventListener(l,m,{passive:v})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var a;Object.entries((a=i.handlers)!=null?a:[]).forEach(([c,f])=>{if(i&&i.connected instanceof HTMLElement){const[m]=Fe[c];i.connected.removeEventListener(m,f)}}),o(c=>({events:{...c.events,connected:void 0}}))}}}}const ar=u.forwardRef(function({children:t,fallback:o,resize:i,style:a,gl:c,events:f=sr,eventSource:m,eventPrefix:l,shadows:v,linear:r,flat:n,legacy:s,orthographic:g,frameloop:h,dpr:b,performance:d,raycaster:p,camera:y,scene:C,onPointerMissed:S,onCreated:P,...E},k){u.useMemo(()=>Mt(vn),[]);const O=xn(),[R,I]=Cn({scroll:!0,debounce:{scroll:50,resize:0},...i}),_=u.useRef(null),A=u.useRef(null);u.useImperativeHandle(k,()=>_.current);const $=jt(S),[X,B]=u.useState(!1),[N,H]=u.useState(!1);if(X)throw X;if(N)throw N;const w=u.useRef(null);me(()=>{const x=_.current;I.width>0&&I.height>0&&x&&(w.current||(w.current=rr(x)),w.current.configure({gl:c,events:f,shadows:v,linear:r,flat:n,legacy:s,orthographic:g,frameloop:h,dpr:b,performance:d,raycaster:p,camera:y,scene:C,size:I,onPointerMissed:(...j)=>$.current==null?void 0:$.current(...j),onCreated:j=>{j.events.connect==null||j.events.connect(m?Hn(m)?m.current:m:A.current),l&&j.setEvents({compute:(L,T)=>{const W=L[l+"X"],V=L[l+"Y"];T.pointer.set(W/T.size.width*2-1,-(V/T.size.height)*2+1),T.raycaster.setFromCamera(T.pointer,T.camera)}}),P==null||P(j)}}),w.current.render(G.jsx(O,{children:G.jsx(Ot,{set:H,children:G.jsx(u.Suspense,{fallback:G.jsx($n,{set:B}),children:t})})})))}),u.useEffect(()=>{const x=_.current;if(x)return()=>zt(x)},[]);const M=m?"none":"auto";return G.jsx("div",{ref:A,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:M,...a},...E,children:G.jsx("div",{ref:R,style:{width:"100%",height:"100%"},children:G.jsx("canvas",{ref:_,style:{display:"block"},children:o})})})}),Gr=u.forwardRef(function(t,o){return G.jsx(Pn,{children:G.jsx(ar,{...t,ref:o})})}),he=new U,Qe=new U,lr=new U,ht=new Xe;function cr(e,t,o){const i=he.setFromMatrixPosition(e.matrixWorld);i.project(t);const a=o.width/2,c=o.height/2;return[i.x*a+a,-(i.y*c)+c]}function ur(e,t){const o=he.setFromMatrixPosition(e.matrixWorld),i=Qe.setFromMatrixPosition(t.matrixWorld),a=o.sub(i),c=t.getWorldDirection(lr);return a.angleTo(c)>Math.PI/2}function fr(e,t,o,i){const a=he.setFromMatrixPosition(e.matrixWorld),c=a.clone();c.project(t),ht.set(c.x,c.y),o.setFromCamera(ht,t);const f=o.intersectObjects(i,!0);if(f.length){const m=f[0].distance;return a.distanceTo(o.ray.origin)<m}return!0}function dr(e,t){if(t instanceof qe)return t.zoom;if(t instanceof Ue){const o=he.setFromMatrixPosition(e.matrixWorld),i=Qe.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,c=o.distanceTo(i);return 1/(2*Math.tan(a/2)*c)}else return 1}function pr(e,t,o){if(t instanceof Ue||t instanceof qe){const i=he.setFromMatrixPosition(e.matrixWorld),a=Qe.setFromMatrixPosition(t.matrixWorld),c=i.distanceTo(a),f=(o[1]-o[0])/(t.far-t.near),m=o[1]-f*t.far;return Math.round(f*c+m)}}const Ve=e=>Math.abs(e)<1e-10?0:e;function Ht(e,t,o=""){let i="matrix3d(";for(let a=0;a!==16;a++)i+=Ve(t[a]*e.elements[a])+(a!==15?",":")");return o+i}const mr=(e=>t=>Ht(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),vr=(e=>(t,o)=>Ht(t,e(o),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function hr(e){return e&&typeof e=="object"&&"current"in e}const Nr=u.forwardRef(({children:e,eps:t=.001,style:o,className:i,prepend:a,center:c,fullscreen:f,portal:m,distanceFactor:l,sprite:v=!1,transform:r=!1,occlude:n,onOcclude:s,castShadow:g,receiveShadow:h,material:b,geometry:d,zIndexRange:p=[16777271,0],calculatePosition:y=cr,as:C="div",wrapperClass:S,pointerEvents:P="auto",...E},k)=>{const{gl:O,camera:R,scene:I,size:_,raycaster:A,events:$,viewport:X}=z(),[B]=u.useState(()=>document.createElement(C)),N=u.useRef(),H=u.useRef(null),w=u.useRef(0),M=u.useRef([0,0]),x=u.useRef(null),j=u.useRef(null),L=(m==null?void 0:m.current)||$.connected||O.domElement.parentNode,T=u.useRef(null),W=u.useRef(!1),V=u.useMemo(()=>n&&n!=="blending"||Array.isArray(n)&&n.length&&hr(n[0]),[n]);u.useLayoutEffect(()=>{const q=O.domElement;n&&n==="blending"?(q.style.zIndex=`${Math.floor(p[0]/2)}`,q.style.position="absolute",q.style.pointerEvents="none"):(q.style.zIndex=null,q.style.position=null,q.style.pointerEvents=null)},[n]),u.useLayoutEffect(()=>{if(H.current){const q=N.current=Sn(B);if(I.updateMatrixWorld(),r)B.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const D=y(H.current,R,_);B.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${D[0]}px,${D[1]}px,0);transform-origin:0 0;`}return L&&(a?L.prepend(B):L.appendChild(B)),()=>{L&&L.removeChild(B),q.unmount()}}},[L,r]),u.useLayoutEffect(()=>{S&&(B.className=S)},[S]);const Y=u.useMemo(()=>r?{position:"absolute",top:0,left:0,width:_.width,height:_.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:c?"translate3d(-50%,-50%,0)":"none",...f&&{top:-_.height/2,left:-_.width/2,width:_.width,height:_.height},...o},[o,c,f,_,r]),re=u.useMemo(()=>({position:"absolute",pointerEvents:P}),[P]);u.useLayoutEffect(()=>{if(W.current=!1,r){var q;(q=N.current)==null||q.render(u.createElement("div",{ref:x,style:Y},u.createElement("div",{ref:j,style:re},u.createElement("div",{ref:k,className:i,style:o,children:e}))))}else{var D;(D=N.current)==null||D.render(u.createElement("div",{ref:k,style:Y,className:i,children:e}))}});const oe=u.useRef(!0);ve(q=>{if(H.current){R.updateMatrixWorld(),H.current.updateWorldMatrix(!0,!1);const D=r?M.current:y(H.current,R,_);if(r||Math.abs(w.current-R.zoom)>t||Math.abs(M.current[0]-D[0])>t||Math.abs(M.current[1]-D[1])>t){const ee=ur(H.current,R);let K=!1;V&&(Array.isArray(n)?K=n.map(te=>te.current):n!=="blending"&&(K=[I]));const ue=oe.current;if(K){const te=fr(H.current,R,A,K);oe.current=te&&!ee}else oe.current=!ee;ue!==oe.current&&(s?s(!oe.current):B.style.display=oe.current?"block":"none");const ge=Math.floor(p[0]/2),Yt=n?V?[p[0],ge]:[ge-1,0]:p;if(B.style.zIndex=`${pr(H.current,R,Yt)}`,r){const[te,ot]=[_.width/2,_.height/2],xe=R.projectionMatrix.elements[5]*ot,{isOrthographicCamera:it,top:Kt,left:Zt,bottom:Jt,right:Qt}=R,en=mr(R.matrixWorldInverse),tn=it?`scale(${xe})translate(${Ve(-(Qt+Zt)/2)}px,${Ve((Kt+Jt)/2)}px)`:`translateZ(${xe}px)`;let ne=H.current.matrixWorld;v&&(ne=R.matrixWorldInverse.clone().transpose().copyPosition(ne).scale(H.current.scale),ne.elements[3]=ne.elements[7]=ne.elements[11]=0,ne.elements[15]=1),B.style.width=_.width+"px",B.style.height=_.height+"px",B.style.perspective=it?"":`${xe}px`,x.current&&j.current&&(x.current.style.transform=`${tn}${en}translate(${te}px,${ot}px)`,j.current.style.transform=vr(ne,1/((l||10)/400)))}else{const te=l===void 0?1:dr(H.current,R)*l;B.style.transform=`translate3d(${D[0]}px,${D[1]}px,0) scale(${te})`}M.current=D,w.current=R.zoom}}if(!V&&T.current&&!W.current)if(r){if(x.current){const D=x.current.children[0];if(D!=null&&D.clientWidth&&D!=null&&D.clientHeight){const{isOrthographicCamera:ee}=R;if(ee||d)E.scale&&(Array.isArray(E.scale)?E.scale instanceof U?T.current.scale.copy(E.scale.clone().divideScalar(1)):T.current.scale.set(1/E.scale[0],1/E.scale[1],1/E.scale[2]):T.current.scale.setScalar(1/E.scale));else{const K=(l||10)/400,ue=D.clientWidth*K,ge=D.clientHeight*K;T.current.scale.set(ue,ge,1)}W.current=!0}}}else{const D=B.children[0];if(D!=null&&D.clientWidth&&D!=null&&D.clientHeight){const ee=1/X.factor,K=D.clientWidth*ee,ue=D.clientHeight*ee;T.current.scale.set(K,ue,1),W.current=!0}T.current.lookAt(q.camera.position)}});const rt=u.useMemo(()=>({vertexShader:r?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[r]);return u.createElement("group",J({},E,{ref:H}),n&&!V&&u.createElement("mesh",{castShadow:g,receiveShadow:h,ref:T},d||u.createElement("planeGeometry",null),b||u.createElement("shaderMaterial",{side:Et,vertexShader:rt.vertexShader,fragmentShader:rt.fragmentShader})))}),De=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function $t(e,t){const o=z(c=>c.gl),i=Q(Ye,De(e)?Object.values(e):e);return u.useLayoutEffect(()=>{t==null||t(i)},[t]),u.useEffect(()=>{if("initTexture"in o){let c=[];Array.isArray(i)?c=i:i instanceof We?c=[i]:De(i)&&(c=Object.values(i)),c.forEach(f=>{f instanceof We&&o.initTexture(f)})}},[o,i]),u.useMemo(()=>{if(De(e)){const c={};let f=0;for(const m in e)c[m]=i[f++];return c}else return i},[e,i])}$t.preload=e=>Q.preload(Ye,e);$t.clear=e=>Q.clear(Ye,e);let we=null,Wt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Gt(e,t,o){return i=>{o&&o(i),e&&(we||(we=new Rn),we.setDecoderPath(typeof e=="string"?e:Wt),i.setDRACOLoader(we)),t&&i.setMeshoptDecoder(typeof Re=="function"?Re():Re)}}function et(e,t=!0,o=!0,i){return Q(Ke,e,Gt(t,o,i))}et.preload=(e,t=!0,o=!0,i)=>Q.preload(Ke,e,Gt(t,o,i));et.clear=e=>Q.clear(Ke,e);et.setDecoderPath=e=>{Wt=e};function gr(e,t,o){const i=z(s=>s.size),a=z(s=>s.viewport),c=typeof e=="number"?e:i.width*a.dpr,f=i.height*a.dpr,m=(typeof e=="number"?o:e)||{},{samples:l=0,depth:v,...r}=m,n=u.useMemo(()=>{const s=new hn(c,f,{minFilter:st,magFilter:st,type:_t,...r});return v&&(s.depthTexture=new gn(c,f,yn)),s.samples=l,s},[]);return u.useLayoutEffect(()=>{n.setSize(c,f),l&&(n.samples=l)},[l,n,c,f]),u.useEffect(()=>()=>n.dispose(),[]),n}const yr=e=>typeof e=="function",Vr=u.forwardRef(({envMap:e,resolution:t=256,frames:o=1/0,makeDefault:i,children:a,...c},f)=>{const m=z(({set:d})=>d),l=z(({camera:d})=>d),v=z(({size:d})=>d),r=u.useRef(null);u.useImperativeHandle(f,()=>r.current,[]);const n=u.useRef(null),s=gr(t);u.useLayoutEffect(()=>{c.manual||(r.current.aspect=v.width/v.height)},[v,c]),u.useLayoutEffect(()=>{r.current.updateProjectionMatrix()});let g=0,h=null;const b=yr(a);return ve(d=>{b&&(o===1/0||g<o)&&(n.current.visible=!1,d.gl.setRenderTarget(s),h=d.scene.background,e&&(d.scene.background=e),d.gl.render(d.scene,r.current),d.scene.background=h,d.gl.setRenderTarget(null),n.current.visible=!0,g++)}),u.useLayoutEffect(()=>{if(i){const d=l;return m(()=>({camera:r.current})),()=>m(()=>({camera:d}))}},[r,i,m]),u.createElement(u.Fragment,null,u.createElement("perspectiveCamera",J({ref:r},c),!b&&a),u.createElement("group",{ref:n},b&&a(s.texture)))}),qr=u.forwardRef(({makeDefault:e,camera:t,regress:o,domElement:i,enableDamping:a=!0,keyEvents:c=!1,onChange:f,onStart:m,onEnd:l,...v},r)=>{const n=z(E=>E.invalidate),s=z(E=>E.camera),g=z(E=>E.gl),h=z(E=>E.events),b=z(E=>E.setEvents),d=z(E=>E.set),p=z(E=>E.get),y=z(E=>E.performance),C=t||s,S=i||h.connected||g.domElement,P=u.useMemo(()=>new jn(C),[C]);return ve(()=>{P.enabled&&P.update()},-1),u.useEffect(()=>(c&&P.connect(c===!0?S:c),P.connect(S),()=>void P.dispose()),[c,S,o,P,n]),u.useEffect(()=>{const E=R=>{n(),o&&y.regress(),f&&f(R)},k=R=>{m&&m(R)},O=R=>{l&&l(R)};return P.addEventListener("change",E),P.addEventListener("start",k),P.addEventListener("end",O),()=>{P.removeEventListener("start",k),P.removeEventListener("end",O),P.removeEventListener("change",E)}},[f,m,l,P,n,b]),u.useEffect(()=>{if(e){const E=p().controls;return d({controls:P}),()=>d({controls:E})}},[e,P]),u.createElement("primitive",J({ref:r,object:P,enableDamping:a},v))}),br=3e3,wr=3001,ze={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Er="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Ee=e=>Array.isArray(e);function Nt({files:e=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:t="",preset:o=void 0,encoding:i=void 0,extensions:a}={}){var c;let f=null,m=!1,l;if(o){if(!(o in ze))throw new Error("Preset must be one of: "+Object.keys(ze).join(", "));e=ze[o],t=Er}const v=Ee(e)&&e.length===6,r=Ee(e)&&e.length===3&&e.some(d=>d.endsWith("json")),n=Ee(e)?e[0]:e;if(m=Ee(e),l=v?"cube":r?"webp":n.startsWith("data:application/exr")?"exr":n.startsWith("data:application/hdr")?"hdr":n.startsWith("data:image/jpeg")?"jpg":(c=n.split(".").pop())==null||(c=c.split("?"))==null||(c=c.shift())==null?void 0:c.toLowerCase(),f=l==="cube"?En:l==="hdr"?On:l==="exr"?kn:l==="jpg"||l==="jpeg"?Ln:l==="webp"?An:null,!f)throw new Error("useEnvironment: Unrecognized file extension: "+e);const s=z(d=>d.gl),g=Q(f,m?[e]:e,d=>{(l==="webp"||l==="jpg"||l==="jpeg")&&d.setRenderer(s),d.setPath==null||d.setPath(t),a&&a(d)});let h=m?g[0]:g;if(l==="jpg"||l==="jpeg"||l==="webp"){var b;h=(b=h.renderTarget)==null?void 0:b.texture}return h.mapping=v?bn:wn,"colorSpace"in h?h.colorSpace=i??v?"srgb":"srgb-linear":h.encoding=i??v?wr:br,h}const _r=e=>e.current&&e.current.isScene,Cr=e=>_r(e)?e.current:e;function tt(e,t,o,i,a={}){var c,f,m,l,v;a={backgroundBlurriness:(c=a.blur)!==null&&c!==void 0?c:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...a};const r=Cr(t||o),n=r.background,s=r.environment,g={backgroundBlurriness:r.backgroundBlurriness,backgroundIntensity:r.backgroundIntensity,backgroundRotation:(f=(m=r.backgroundRotation)==null||m.clone==null?void 0:m.clone())!==null&&f!==void 0?f:[0,0,0],environmentIntensity:r.environmentIntensity,environmentRotation:(l=(v=r.environmentRotation)==null||v.clone==null?void 0:v.clone())!==null&&l!==void 0?l:[0,0,0]};return e!=="only"&&(r.environment=i),e&&(r.background=i),Z(r,a),()=>{e!=="only"&&(r.environment=s),e&&(r.background=n),Z(r,g)}}function nt({scene:e,background:t=!1,map:o,...i}){const a=z(c=>c.scene);return u.useLayoutEffect(()=>{if(o)return tt(t,e,a,o,i)}),null}function Vt({background:e=!1,scene:t,blur:o,backgroundBlurriness:i,backgroundIntensity:a,backgroundRotation:c,environmentIntensity:f,environmentRotation:m,...l}){const v=Nt(l),r=z(n=>n.scene);return u.useLayoutEffect(()=>tt(e,t,r,v,{blur:o,backgroundBlurriness:i,backgroundIntensity:a,backgroundRotation:c,environmentIntensity:f,environmentRotation:m})),null}function Pr({children:e,near:t=1,far:o=1e3,resolution:i=256,frames:a=1,map:c,background:f=!1,blur:m,backgroundBlurriness:l,backgroundIntensity:v,backgroundRotation:r,environmentIntensity:n,environmentRotation:s,scene:g,files:h,path:b,preset:d=void 0,extensions:p}){const y=z(O=>O.gl),C=z(O=>O.scene),S=u.useRef(null),[P]=u.useState(()=>new Ce),E=u.useMemo(()=>{const O=new _n(i);return O.texture.type=_t,O},[i]);u.useLayoutEffect(()=>(a===1&&S.current.update(y,P),tt(f,g,C,E.texture,{blur:m,backgroundBlurriness:l,backgroundIntensity:v,backgroundRotation:r,environmentIntensity:n,environmentRotation:s})),[e,P,E.texture,g,C,f,a,y]);let k=1;return ve(()=>{(a===1/0||k<a)&&(S.current.update(y,P),k++)}),u.createElement(u.Fragment,null,Bt(u.createElement(u.Fragment,null,e,u.createElement("cubeCamera",{ref:S,args:[t,o,E]}),h||d?u.createElement(Vt,{background:!0,files:h,preset:d,path:b,extensions:p}):c?u.createElement(nt,{background:!0,map:c,extensions:p}):null),P))}function xr(e){var t,o,i,a;const c=Nt(e),f=e.map||c;u.useMemo(()=>Mt({GroundProjectedEnvImpl:Tn}),[]);const m=u.useMemo(()=>[f],[f]),l=(t=e.ground)==null?void 0:t.height,v=(o=e.ground)==null?void 0:o.radius,r=(i=(a=e.ground)==null?void 0:a.scale)!==null&&i!==void 0?i:1e3;return u.createElement(u.Fragment,null,u.createElement(nt,J({},e,{map:f})),u.createElement("groundProjectedEnvImpl",{args:m,scale:r,height:l,radius:v}))}function Ur(e){return e.ground?u.createElement(xr,e):e.map?u.createElement(nt,e):e.children?u.createElement(Pr,e):u.createElement(Vt,e)}const Xr=u.forwardRef(({args:e,map:t,toneMapped:o=!1,color:i="white",form:a="rect",intensity:c=1,scale:f=1,target:m,children:l,...v},r)=>{const n=u.useRef(null);return u.useImperativeHandle(r,()=>n.current,[]),u.useLayoutEffect(()=>{!l&&!v.material&&(Z(n.current.material,{color:i}),n.current.material.color.multiplyScalar(c))},[i,c,l,v.material]),u.useLayoutEffect(()=>{m&&n.current.lookAt(Array.isArray(m)?new U(...m):m)},[m]),f=Array.isArray(f)&&f.length===2?[f[0],f[1],1]:f,u.createElement("mesh",J({ref:n,scale:f},v),a==="circle"?u.createElement("ringGeometry",{args:[0,1,64]}):a==="ring"?u.createElement("ringGeometry",{args:[.5,1,64]}):a==="rect"?u.createElement("planeGeometry",null):u.createElement(a,{args:e}),l||(v.material?null:u.createElement("meshBasicMaterial",{toneMapped:o,map:t,side:Et})))}),Mr=e=>e&&e.isOrthographicCamera,gt=new bt,qt=In();function Ut(e){return"top"in e}function Be(e,t){const{right:o,top:i,left:a,bottom:c,width:f,height:m}=t,l=t.bottom<0||i>e.height||o<0||t.left>e.width;if(Ut(e)){const n=e.top+e.height-c,s=a-e.left;return{position:{width:f,height:m,left:s,top:i,bottom:n,right:o},isOffscreen:l}}const v=e.height-c;return{position:{width:f,height:m,top:i,left:a,bottom:v,right:o},isOffscreen:l}}function He(e,{left:t,bottom:o,width:i,height:a}){let c;const f=i/a;return Mr(e.camera)?(e.camera.left!==i/-2||e.camera.right!==i/2||e.camera.top!==a/2||e.camera.bottom!==a/-2)&&(Object.assign(e.camera,{left:i/-2,right:i/2,top:a/2,bottom:a/-2}),e.camera.updateProjectionMatrix()):e.camera.aspect!==f&&(e.camera.aspect=f,e.camera.updateProjectionMatrix()),c=e.gl.autoClear,e.gl.autoClear=!1,e.gl.setViewport(t,o,i,a),e.gl.setScissor(t,o,i,a),e.gl.setScissorTest(!0),c}function $e(e,t){e.gl.setScissorTest(!1),e.gl.autoClear=t}function yt(e){e.gl.getClearColor(gt),e.gl.setClearColor(gt,e.gl.getClearAlpha()),e.gl.clear(!0,!0)}function Sr({visible:e=!0,canvasSize:t,scene:o,index:i,children:a,frames:c,rect:f,track:m}){const l=z(),[v,r]=u.useState(!1);let n=0;return ve(s=>{if(c===1/0||n<=c){var g;m&&(f.current=(g=m.current)==null?void 0:g.getBoundingClientRect()),n++}if(f.current){const{position:h,isOffscreen:b}=Be(t,f.current);if(v!==b&&r(b),e&&!v&&f.current){const d=He(s,h);s.gl.render(a?s.scene:o,s.camera),$e(s,d)}}},i),u.useLayoutEffect(()=>{const s=f.current;if(s&&(!e||!v)){const{position:g}=Be(t,s),h=He(l,g);yt(l),$e(l,h)}},[e,v]),u.useEffect(()=>{if(!m)return;const s=f.current,g=l.get().events.connected;return l.setEvents({connected:m.current}),()=>{if(s){const{position:h}=Be(t,s),b=He(l,h);yt(l),$e(l,b)}l.setEvents({connected:g})}},[m]),u.useEffect(()=>{Ut(t)||console.warn(`Detected @react-three/fiber canvas size does not include position information. <View /> may not work as expected. Upgrade to @react-three/fiber ^8.1.0 for support.
 See https://github.com/pmndrs/drei/issues/944`)},[]),u.createElement(u.Fragment,null,a,u.createElement("group",{onPointerOver:()=>null}))}const Xt=u.forwardRef(({track:e,visible:t=!0,index:o=1,id:i,style:a,className:c,frames:f=1/0,children:m,...l},v)=>{var r,n,s,g;const h=u.useRef(null),{size:b,scene:d}=z(),[p]=u.useState(()=>new Ce),[y,C]=u.useReducer(()=>!0,!1),S=u.useCallback((P,E)=>{if(h.current&&e&&e.current&&P.target===e.current){const{width:k,height:O,left:R,top:I}=h.current,_=P.clientX-R,A=P.clientY-I;E.pointer.set(_/k*2-1,-(A/O)*2+1),E.raycaster.setFromCamera(E.pointer,E.camera)}},[h,e]);return u.useEffect(()=>{var P;e&&(h.current=(P=e.current)==null?void 0:P.getBoundingClientRect()),C()},[e]),u.createElement("group",J({ref:v},l),y&&Bt(u.createElement(Sr,{visible:t,canvasSize:b,frames:f,scene:d,track:e,rect:h,index:o},m),p,{events:{compute:S,priority:o},size:{width:(r=h.current)==null?void 0:r.width,height:(n=h.current)==null?void 0:n.height,top:(s=h.current)==null?void 0:s.top,left:(g=h.current)==null?void 0:g.left}}))}),Rr=u.forwardRef(({as:e="div",id:t,visible:o,className:i,style:a,index:c=1,track:f,frames:m=1/0,children:l,...v},r)=>{const n=u.useId(),s=u.useRef(null);return u.useImperativeHandle(r,()=>s.current),u.createElement(u.Fragment,null,u.createElement(e,J({ref:s,id:t,className:i,style:a},v)),u.createElement(qt.In,null,u.createElement(Xt,{visible:o,key:n,track:s,frames:m,index:c},l)))}),jr=u.forwardRef((e,t)=>u.useContext(Pe)?u.createElement(Xt,J({ref:t},e)):u.createElement(Rr,J({ref:t},e)));jr.Port=()=>u.createElement(qt.Out,null);export{Gr as C,Ur as E,Nr as H,Xr as L,qr as O,Vr as P,jr as V,$t as a,Wr as g,et as u};
